<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.self_board_project.room.mapper.RoomMapper">
    <sql id="selectQuery">
        SELECT t1.id,
               t1.room_id,
               t1.room_boss_id,
               t1.room_staff_id,
               t1.create_date
        FROM room t1
    </sql>
    <select id="countRoom" resultType="com.example.self_board_project.room.vo.Room">
        /** countRoom **/
        select SUM(if(t1.field = 'relationship' and t1.read_yn = 'N', 1, 0)) relationshipCount,
               SUM(if(t1.field = 'evaluation' and t1.read_yn = 'N', 1, 0))   evaluationCount,
               SUM(if(t1.read_yn = 'N', 1, 0))                               totalNCount,
               count(1)                                                      totalCount
        from room t1
        WHERE t1.user_id = #{userId}
    </select>
    <select id="selectRoomList" resultType="com.example.self_board_project.room.vo.Room">
        /** selectRoomList **/
        <include refid="selectQuery"/>
        <where>
            <if test="roomBossId != null and roomBossId != ''">
                AND t1.`roomBossId` = #{roomBossId}
            </if>

            <if test="roomStaffId != null and roomStaffId != ''">
                AND t1.`room_staff_id` = #{roomStaffId}
            </if>
        </where>
    </select>

    <select id="selectRoom" resultType="com.example.self_board_project.room.vo.Room">
        /** selectRoom **/
        <include refid="selectQuery"/>
                <where>
                    <if test="id != null and id != ''">
                        AND t1.`id` = #{id}
                    </if>
                    <if test="roomBossId != null and roomBossId != ''">
                        AND t1.`room_boss_id` = #{roomBossId}
                    </if>
                    <if test="roomStaffId != null and roomStaffId != ''">
                        AND t1.`room_staff_id` = #{roomStaffId}
                    </if>
                </where>
    </select>
    <insert id="insertRoom" useGeneratedKeys="true" keyProperty="id">
        /** insertRoom **/
        INSERT INTO `room`( room_boss_id
                                  , room_staff_id
                                  , create_date)

        VALUES ( #{roomBossId}
               , #{roomStaffId}
               , now())
    </insert>

    <update id="updateRoom">
        /** updateRoom **/
        update `room`
        set session_id = #{sessionId},
            session = #{session}
        WHERE id = #{Id}
<!--        <if test="field != null and field != ''">-->
<!--            AND field = #{field}-->
<!--        </if>-->
    </update>


</mapper>