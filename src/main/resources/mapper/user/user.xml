<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.self_board_project.user.mapper.UserMapper">
    <sql id="selectQuery">
        SELECT id,
               login_id,
               password,
               nickname,
               real_name,
               age,
               gender,
               email,
               phone_number,
               address_doro,
               address_detail,
               postal_code,
               grade_score,
               grade_code,
               job,
               workplace,
               purpose,
               introduce,
               today_profile_id,
               smoking_yn,
               drinking_type,
               religion_type,
               pet_type,
               hobby,
               ideal_type,
               mbti,
               height,
               academic,
               body_type,
               personality,
               create_date,
               update_date,
               update_id,
               (select image_name from file t2 where t1.id = t2.ref_id and t2.flag = 'S' AND boss_type = "Y") image_name
        FROM user t1
    </sql>


    <select id="selectUserList" resultType="com.example.self_board_project.user.vo.User">
        /** selectUserList **/
        <include refid="selectQuery"/>
    </select>

    <select id="selectUserRandomList" resultType="com.example.self_board_project.user.vo.User">
        /** selectUserRandomList **/
        <include refid="selectQuery"/>
        <where>
            <if test="gender != null and gender != ''">
                AND gender = #{gender}
            </if>
            order by rand() limit 2;
        </where>
    </select>

    <select id="selectUser" resultType="com.example.self_board_project.user.vo.User">
        /** selectUser **/
        <include refid="selectQuery"/>
        <where>
            <if test="id != null and id != ''">
                AND t1.id = #{id}
            </if>
            <if test="nickname != null and nickname != ''">
                AND t1.nickname = #{nickname}
            </if>
            <if test="email != null and email != ''">
                AND t1.email = #{email}
            </if>
            <if test="realName != null and realName != ''">
                AND t1.real_name = #{realName}
            </if>
        </where>
    </select>

    <insert id="insertUser" useGeneratedKeys="true" keyProperty="id">
        /** insertUser **/
        INSERT INTO `user`( login_id
                          , password
                          , real_name
                          , nickname
                          , age
                          , gender
                          , email
                          , phone_number
                          , address_doro
                          , address_detail
                          , postal_code
                          , job
                          , workplace
                          , purpose
                          , introduce
                          , smoking_yn
                          , drinking_type
                          , religion_type
                          , pet_type
                          , hobby
                          , ideal_type
                          , mbti
                          , height
                          , academic
                          , body_type
                          , personality
                          , provider
                          , provider_id
                          , username
                          , role
                          , create_date)

        VALUES ( #{loginId}
               , #{password}
               , #{realName}
               , #{nickname}
               , #{age}
               , #{gender}
               , #{email}
               , #{phoneNumber}
               , #{addressDoro}
               , #{addressDetail}
               , #{postalCode}
               , #{job}
               , #{workplace}
               , #{purpose}
               , #{introduce}
               , #{smokingYn}
               , #{drinkingType}
               , #{religionType}
               , #{petType}
               , #{hobby}
               , #{idealType}
               , #{mbti}
               , #{height}
               , #{academic}
               , #{bodyType}
               , #{personality}
               , #{provider}
               , #{providerId}
               , #{username}
               , #{role}
               , now())
    </insert>


    <update id="updateUser">
        /** updateUser **/
        UPDATE user
        SET login_id= #{loginId},
            password= #{password},
            nickname= #{nickname},
            real_name= #{realName},
            age= #{age},
            gender= #{gender},
            email= #{email},
            phone_number= #{phoneNumber},
            introduce= #{introduce},
            address_doro = #{addressDoro},
            address_detail = #{addressDetail},
            postal_code = #{postalCode},
            job = #{job},
            purpose = #{purpose},
            introduce = #{introduce},
            smoking_yn = #{smokingYn},
            drinking_type = #{drinkingType},
            religion_type = #{religionType},
            pet_type = #{petType},
            hobby = #{hobby},
            ideal_type = #{idealType},
            mbti = #{mbti},
            height = #{height},
            academic = #{academic},
            body_type = #{bodyType},
            personality = #{personality},
            today_profile_id= #{todayProfileId},
            update_date= now()
        WHERE id = #{id}
    </update>

    <update id="updateTodayProfileId">
        /** updateTodayProfileId **/
        UPDATE user
        SET today_profile_id = #{todayProfileId}
        WHERE id = #{id}
    </update>

</mapper>