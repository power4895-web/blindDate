<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.self_board_project.user.mapper.UserMapper">
    <!--    <sql id="selectUser">-->
    <!--        SELECT id,-->
    <!--               login_id,-->
    <!--               password,-->
    <!--               nickname,-->
    <!--               real_name,-->
    <!--               age,-->
    <!--               gender,-->
    <!--               email,-->
    <!--               phone_number,-->
    <!--               introduce,-->
    <!--               create_date,-->
    <!--               update_date,-->
    <!--               update_id-->
    <!--        FROM `user`;-->
    <!--    </sql>-->


    <select id="selectUserList" resultType="com.example.self_board_project.user.vo.User">
        /** selectUserList **/
        SELECT id,
               login_id,
               password,
               nickname,
               real_name,
               age,
               gender,
               email,
               phone_number,
               introduce,
               today_profile_id,
               create_date,
               update_date,
               update_id,
               (select image_name  from file t2 where t1.id = t2.ref_id and t2.flag = 'S' AND boss_type = "Y") image_name
        FROM user t1
    </select>

    <select id="selectUserRandomList" resultType="com.example.self_board_project.user.vo.User">
        /** selectUserRandomList **/
        select id,
               login_id,
               password,
               nickname,
               real_name,
               age,
               gender,
               email,
               phone_number,
               introduce,
               today_profile_id,
               create_date,
               update_date,
               update_id
        from user
        WHERE gender = #{gender}
        order by rand() limit 2;
    </select>

    <select id="selectUser" resultType="com.example.self_board_project.user.vo.User">
        /** selectUser **/
        SELECT id,
            login_id,
            password,
            nickname,
            real_name,
            age,
            gender,
            email,
            phone_number,
            introduce,
            today_profile_id,
            create_date,
            update_date,
            update_id,
            (select concat(filepath,image_name) from file where ref_id = t1.id and boss_type = "Y" AND flag = "S") as imgUrl
        FROM user t1
        WHERE 1=1
        <if test="id != null and id != ''">
            AND t1.id = #{id}
        </if>
        <if test="nickname != null and nickname != ''">
            AND t1.nickname = #{nickname}
        </if>
        <if test="email != null and email != ''">
            AND t1.email = #{email}
        </if>
        <if test="realName != null and realName != ''">
            AND t1.real_name = #{realName}
        </if>
    </select>

    <insert id="insertUser" useGeneratedKeys="true" keyProperty="id">
        /** insertUser **/
        INSERT INTO `user`( login_id
                          , password
                          , real_name
                          , nickname
                          , age
                          , gender
                          , email
                          , introduce
                          , phone_number
                          , provider
                          , provider_id
                          , username
                          , role
                          , create_date)

        VALUES ( #{loginId}
               , #{password}
               , #{realName}
               , #{nickname}
               , #{age}
               , #{gender}
               , #{email}
               , #{introduce}
               , #{phoneNumber}
               , #{provider}
               , #{providerId}
               , #{username}
               , #{role}
               , now())
    </insert>


    <update id="updateUser">
        UPDATE user
        SET login_id = #{loginId},
            password = #{password},
            nickname= #{nickname},
            real_name= #{realName},
            age= #{age},
            gender= #{gender},
            email= #{email},
            phone_number= #{phoneNumber},
            introduce= #{introduce},
            today_profile_id= #{todayProfileId},
            update_date= now()
        WHERE id = #{id}


    </update>
    <update id="updateTodayProfileId">
        UPDATE user
        SET today_profile_id = #{todayProfileId}
        WHERE id = #{id}
    </update>

</mapper>